<script type="text/javascript" src="compile.js"></script>
<script type="text/javascript">

    var l = 10;

    var tf = new concurrent.thread.ThreadedFunction(
        function ( $this_val, $arguments, $continuation ) {
            return function( n ){
                $arguments = arguments;
                var t0, i, j, x, y, z;
                    t0 = new Date();
                    j=0;
                    return {continuation:new concurrent.thread.Continuation(label1, this, arguments)};
                function label1 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        if ( !(j < l) ) return {continuation:new concurrent.thread.Continuation(label3, this, arguments)};
                        i=2, x=1, y=1, z;
                        return {continuation:new concurrent.thread.Continuation(label4, this, arguments)};
                    }.call($this_val);
                }
                function label4 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        if ( !(i <= n) ) return {continuation:new concurrent.thread.Continuation(label6, this, arguments)};
                        z = x + y;
                        x = y;
                        y = z;
                        return {continuation:new concurrent.thread.Continuation(label5, this, arguments)};
                    }.call($this_val);
                }
                function label5 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        i++;
                        return {continuation:new concurrent.thread.Continuation(label4, this, arguments)};
                    }.call($this_val);
                }
                function label6 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        return {continuation:new concurrent.thread.Continuation(label2, this, arguments)};
                    }.call($this_val);
                }
                function label2 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        j++;
                        return {continuation:new concurrent.thread.Continuation(label1, this, arguments)};
                    }.call($this_val);
                }
                function label3 ( $this_val, $arguments, $ret_val ) {
                    return function(){
                        arguments = $arguments;
                        alert(y + "\n" + ((new Date()).valueOf()-t0.valueOf()));
                        return {continuation:$continuation, ret_vat:y};
                    }.call($this_val);
                }
            }.apply($this_val, $arguments);
        }
    );

    concurrent.thread.TIME_SLICE = Infinity;
    tf.start(1000);

</script>
